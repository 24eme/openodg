<?php include_partial($objetType.'/breadcrumb', array(''.$objetType => $objet )); ?>

<?php include_partial($objetType.'/step', array('step' => 'exploitation', ''.$objetType => $objet)) ?>
<div class="page-header">
    <h2>Entreprise <small>Données administratives, merci de les modifier en cas de changement</small></h2>
</div>

<form action="<?php echo url_for($objetType."_exploitation", $objet) ?>" method="post" class="form-horizontal ajaxForm">
    <?php include_partial('etablissement/form', array('form' => $form, 'etablissement' => $etablissement)); ?>

    <?php if(isset($form['chais_adresse'])): ?>
    <h3>Logement du vin</h3>
    <div class="row row-margin" style="margin-bottom: 20px;">
        <div class="row_info_exploitation col-xs-12 <?php if($form->isBound()): ?>hidden<?php endif; ?>">
            <div class="col-xs-12 <?php if($form['chais_nom']->getValue() || $form['chais_adresse']->getValue() || $form['chais_commune']->getValue() || $form['chais_code_postal']->getValue()): ?>hidden<?php endif; ?>">
                <div class="form-group">
                    <p class="form-control-static">Le vin est logé à la même adresse que l'entreprise</p>
                </div>
            </div>
            <div class="col-xs-7 col-xs-offset-5 <?php if(!$form['chais_nom']->getValue() && !$form['chais_adresse']->getValue() && !$form['chais_commune']->getValue() && !$form['chais_code_postal']->getValue()): ?>hidden<?php endif; ?>">
                <div class="form-group">
                    <?php echo $form["chais_nom"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <p class="form-control-static"><?php echo $form['chais_nom']->getValue() ?></p>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_adresse"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <p class="form-control-static"><?php echo $form['chais_adresse']->getValue() ?></p>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_code_postal"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <p class="form-control-static"><?php echo $form['chais_code_postal']->getValue() ?></p>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_commune"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <p class="form-control-static"><?php echo $form['chais_commune']->getValue() ?></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row_form_exploitation <?php if(!$form->isBound()): ?>hidden<?php endif; ?>">
            <div class="col-xs-12">
                <div class="col-xs-12">
                    <div class="form-group">
                        <div class="checkbox">
                            <label>
                                <input id="checkbox_logement_vin" type="checkbox" <?php if(!$form['chais_nom']->getValue() && !$form['chais_adresse']->getValue() && !$form['chais_commune']->getValue() && !$form['chais_code_postal']->getValue()): ?>checked="checked"<?php endif; ?> value="" class="checkbox-relation" data-relation="#form_logement_vin">
                                Le vin est logé à la même adresse que l'entreprise
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 <?php if(!$form['chais_nom']->getValue() && !$form['chais_adresse']->getValue() && !$form['chais_commune']->getValue() && !$form['chais_code_postal']->getValue()): ?>hidden<?php endif; ?>" id="form_logement_vin">
                <div class="col-xs-7 col-xs-offset-5">
                <div class="form-group">
                    <?php echo $form["chais_nom"]->renderError(); ?>
                    <?php echo $form["chais_nom"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <?php echo $form["chais_nom"]->render(array("class" => "form-control")); ?>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_adresse"]->renderError(); ?>
                    <?php echo $form["chais_adresse"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <?php echo $form["chais_adresse"]->render(array("class" => "form-control")); ?>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_code_postal"]->renderError(); ?>
                    <?php echo $form["chais_code_postal"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <?php echo $form["chais_code_postal"]->render(array("class" => "form-control")); ?>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_commune"]->renderError(); ?>
                    <?php echo $form["chais_commune"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <?php echo $form["chais_commune"]->render(array("class" => "form-control")); ?>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
    <?php endif; ?>

    <?php if(isset($form['chai'])): ?>
    <h3>Logement du vin</h3>
    <div class="row row-margin" style="margin-bottom: 20px;">
        <?php if (!isset($force_chais_adresse_differente) || !$force_chais_adresse_differente): ?>
        <div class="row_info_exploitation col-xs-12 <?php if($form->isBound()): ?>hidden<?php endif; ?>">
            <div class="col-xs-12 <?php if($form['chai']->getValue() !== null && $form->getObject()->getDocument()->isAdresseLogementDifferente()): ?>hidden<?php endif; ?>">
                <div class="form-group">
                    <p class="form-control-static">Le vin est logé à la même adresse que l'entreprise</p>
                </div>
            </div>
            <div class="col-xs-7 col-xs-offset-5 <?php if($form['chai']->getValue() === null||!$form->getObject()->getDocument()->isAdresseLogementDifferente()): ?>hidden<?php endif; ?>">
                <div class="form-group">
                    <?php echo $form["chai"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <p class="form-control-static"><?php echo $form->getObject()->getDocument()->getEtablissementObject()->getChai($form['chai']->getValue()) ?></p>
                    </div>
                </div>
            </div>
        </div>
        <?php endif; ?>
        <div class="row_form_exploitation <?php if(!$form->isBound() && (!isset($force_chais_adresse_differente) || !$force_chais_adresse_differente)): ?>hidden<?php endif; ?>">
            <?php if (!isset($force_chais_adresse_differente) || !$force_chais_adresse_differente): ?>
            <div class="col-xs-12">
                <div class="col-xs-12">
                    <div class="form-group">
                        <div class="checkbox">
                            <label>
                                <input id="checkbox_logement_vin" type="checkbox" <?php if($form['chai']->getValue() === null||!$form->getObject()->getDocument()->isAdresseLogementDifferente()): ?>checked="checked"<?php endif; ?> value="" class="checkbox-relation" data-relation="#form_logement_vin">
                                Le vin est logé à la même adresse que l'entreprise
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <?php endif; ?>
            <div class="col-xs-12 <?php if(($form['chai']->getValue() === null||!$form->getObject()->getDocument()->isAdresseLogementDifferente()) && (!isset($force_chais_adresse_differente) || !$force_chais_adresse_differente)): ?>hidden<?php endif; ?>" id="form_logement_vin">
                <div class="col-xs-7 col-xs-offset-5">
                <div class="form-group">
                    <?php echo $form["chai"]->renderError(); ?>
                    <?php echo $form["chai"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <?php echo $form["chai"]->render(array("class" => "form-control", 'required' =>  (isset($force_chais_adresse_differente) && $force_chais_adresse_differente) ? 'required' : '')); ?>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
    <?php endif; ?>

    <div class="row row-margin row-button">
        <div class="col-xs-4"><a href="<?php echo url_for("declaration_etablissement", array('identifiant' => $etablissement->identifiant, 'campagne' => $objet->campagne)); ?>" class="btn btn-default btn-upper"><span class="glyphicon glyphicon-chevron-left"></span> Retourner à mon espace</a></div>
        <div class="col-xs-4 text-center">
<?php if (!isset($force_chais_adresse_differente) || !$force_chais_adresse_differente): ?>
            <a href="" id="btn_exploitation_annuler" class="btn btn-danger hidden">Annuler</a>
            <button id="btn_exploitation_modifier" type="button" class="btn btn-default btn_exploitation_modifier">Modifier</button>
<?php endif; ?>
        </div>
        <div class="col-xs-4 text-right"><button type="submit" class="btn btn-primary btn-upper">Valider et continuer <span class="glyphicon glyphicon-chevron-right"></span></button></div>
    </div>
</form>
